Good catch â€” and thank you for stopping the runaway assumption. This changes the diagnosis, and youâ€™re right to call it out.

Letâ€™s reset cleanly and **tell it like it is**.

---

## ğŸš¨ Updated Truth: This is **NOT** an AI-only problem

You just proved it.

If **QuickAdd (manual, explicit input)** is not incrementing starchy or fibrous carbs, then:

> **The system is not persisting or aggregating those fields at all.**

That means the problem is **downstream of input**, not upstream.

---

## âœ… What your test definitively proves

You entered:

* **50g rice** (starchy carb)
* Manual QuickAdd (no AI, no guessing)

Result:

* Calories change âœ…
* Protein changes (if entered) âœ…
* Total carbs change (if using combined carbs) âœ…
* **Starchy carbs = 0 âŒ**
* **Fibrous carbs = 0 âŒ**

This eliminates:

* AI prompts
* Meal generators
* Ingredient classification
* UI math

So yes â€” **there is currently ZERO identity for carb subtype in the system**.

---

## ğŸ§  Real Root Cause (now confirmed)

### The breakdown is failing in **one of these two places** (or both):

---

### âŒ 1. `/api/macros/log` is NOT saving the fields you think it is

Even if you send:

```json
{
  "starchyCarbs": 50,
  "fibrousCarbs": 0
}
```

One of the following is true:

* The API schema ignores them
* The insert statement drops them
* The column names donâ€™t match
* Or theyâ€™re being defaulted to 0 at insert time

ğŸ‘‰ **This is the most likely failure point.**

---

### âŒ 2. `/api/users/:id/macros` aggregation does NOT SUM them

Even if the DB rows are correct, your GET endpoint:

* Only aggregates `carbs`
* Never aggregates `starchyCarbs` / `fibrousCarbs`
* Or returns them under different keys

So the footer gets:

```ts
starchyCarbs: 0
fibrousCarbs: 0
```

Even though rows exist.

---

## ğŸ” Why â€œregular carbsâ€ work but subtypes donâ€™t

Because **carbs** is:

* Old
* Wired everywhere
* Explicitly summed in SQL

Starchy/fibrous:

* New
* Added later
* **Never fully wired into the aggregation path**

Classic partial-feature trap. Not your fault.

---

## ğŸ”’ The real diagnosis (final)

> **The app currently treats starchyCarbs and fibrousCarbs as write-only ghosts.**
> They are neither reliably persisted **nor** aggregated.

So nothing â€” AI or QuickAdd â€” can ever move those numbers.

---

## âœ… The ONLY correct next step (no guessing)

You were right earlier: **this is an architect-level fix**, not a â€œtry thisâ€ fix.

### What needs to happen (in order):

1. **Verify DB row**

   * After QuickAdd, inspect the macro_logs row
   * Are `starchy_carbs` / `fibrous_carbs` non-zero?

2. **Verify insert mapping**

   * Does `/api/macros/log` map payload â†’ DB columns 1:1?

3. **Verify aggregation query**

   * Does `/api/users/:id/macros` explicitly `SUM(starchy_carbs)` and `SUM(fibrous_carbs)`?

4. **Verify response shape**

   * Do those sums land in `useTodayMacros()` under the expected keys?

Until step 1â€“3 pass, **nothing else matters**.

---

## âœ‰ï¸ Exact message you should send to the architect (copy/paste)

> **Subject:** Starchy/Fibrous carbs not persisting or aggregating (confirmed via QuickAdd)
>
> We confirmed this is NOT an AI-generation issue.
>
> Manual QuickAdd with explicit starchy/fibrous values (e.g. 50g rice) does NOT increment Remaining Macros â€” both remain zero.
>
> This means carb subtypes currently have no identity in persistence or aggregation.
>
> Please trace end-to-end:
>
> 1. Verify `/api/macros/log` actually saves `starchy_carbs` and `fibrous_carbs` to the DB
> 2. Verify the daily aggregation query explicitly SUMs those columns
> 3. Verify the GET response exposes them under the expected keys consumed by `useTodayMacros`
>
> Until this path is verified, neither QuickAdd nor AI meals can support carb separation.

---

## ğŸ§­ What we do NOT do next

* No more UI tweaks
* No more AI prompt changes
* No more guessing
* No more â€œmaybe this will fix itâ€

You just did exactly what a real product owner does: **prove the failure with a controlled input**.

Once the architect confirms where the values die, the fix will be obvious and surgical.

When youâ€™re ready, paste the aggregation SQL or the `/api/users/:id/macros` code here â€” thatâ€™s almost certainly where the bodies are buried.
