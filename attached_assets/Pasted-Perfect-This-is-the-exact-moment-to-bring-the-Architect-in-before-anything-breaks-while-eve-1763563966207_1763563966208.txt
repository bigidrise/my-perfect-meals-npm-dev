Perfect.
This is the exact moment to bring the Architect in ‚Äî **before anything breaks**, while everything is *kinda* working, so we can unify it *correctly* and ensure it all scales.

You're right:
Some features are working.
Some are ‚Äúworking but inconsistent.‚Äù
Some are working by accident.
All of them will eventually break if we don‚Äôt unify the architecture.

So here‚Äôs what I‚Äôm going to give you next:

---

# ‚úÖ THE MASTER ARCHITECT PROMPT

This is the **full, top-level prompt** you give to the Replit Architect.
This will instruct them to unify ALL AI meal-generation systems:

* AI Meal Creator
* AI Premades
* Craving Creator
* Fridge Rescue
* Restaurant Guide
* (Eventually) Meal Finder AI Mode

This prompt is clean, authoritative, and tells the architect exactly what must happen ‚Äî zero guesswork.

Copy ‚Üí Paste ‚Üí Send to Replit Architect.

---

# üß† **MASTER ARCHITECT UNIFICATION PROMPT**

**BEGIN PROMPT**

We need to unify ALL AI meal-generation systems across the app.
Right now:

* **AI Meal Creator** works (uses `/api/meals/fridge-rescue`).
* **AI Premades** works (but uses `/api/meal-images/generate` incorrectly).
* **Craving Creator** worked last night but uses its own inconsistent endpoint.
* **Fridge Rescue** works and has the most complete implementation.
* **Restaurant Guide** works but uses a different architecture.
* **Meal Finder** currently uses no AI but will need to plug into the same system later.

This creates inconsistent behavior and causes API mismatches, 404s, broken images, and different meal formats.

We need a **single Unified AI Meal Generation Architecture** that every feature uses.

---

## ‚úÖ **GOAL: ONE AI ENGINE, ONE ENDPOINT, ONE RESPONSE SHAPE**

Create a new unified AI system based on the robust Fridge Rescue generator:

### NEW GLOBAL ENDPOINT

`POST /api/ai/meals/generate`

### REQUEST FORMAT (universal)

```
{
  "type": "fridge-rescue" | "craving" | "premade" | "restaurant-guide",
  "context": { ... },   // varies by type
  "options": {
    "macroTargets"?: { protein, carbs, fat },
    "userId"?: string,
    "count"?: number
  }
}
```

### RESPONSE FORMAT (universal)

```
{
  "meals": UnifiedMeal[],
  "metadata": {
    "source": string,
    "generatedAt": string
  }
}
```

### UnifiedMeal Structure

```
{
  id: string;
  name: string;
  description: string;

  ingredients: Array<{
    name: string;
    quantity: string;
    unit: string;
  }>;

  instructions: string;

  nutrition: {
    calories: number;
    protein: number;
    carbs: number;
    fat: number;
  };

  cookingTime?: string;
  difficulty?: string;
  servingSize?: string;
  imageUrl?: string;
  medicalBadges: Array<MedicalBadge>;
}
```

All features must return this exact structure.

---

## ‚úÖ **REFACTOR EACH FEATURE TO USE THE UNIFIED SYSTEM**

### 1. AI Meal Creator

Currently: `/api/meals/fridge-rescue`
Update ‚Üí use unified endpoint.

### 2. AI Premades

Currently broken architecture.
Remove call to `/api/meal-images/generate`.
Use unified endpoint with:

```
type: "premade",
context: { ingredients, defaultCookingMethod, mealName }
```

### 3. Craving Creator

Create a real endpoint for this:

```
type: "craving",
context: { cravingInput, dietaryRestrictions, servings, ... }
```

Call unified endpoint.

### 4. Fridge Rescue

Use the same unified endpoint:

```
type: "fridge-rescue",
context: { fridgeItems }
```

### 5. Restaurant Guide

Currently uses its own engine.
Refactor to:

```
type: "restaurant-guide",
context: { dishName, restaurantName, cuisine }
```

### 6. Meal Finder (future AI mode)

Will plug into this system later.

---

## ‚úÖ **UNIFY PROMPTS + AI LOGIC**

Create:

`server/services/ai/promptLibrary.ts`

Contains prompt builders for:

* fridge-rescue
* craving
* restaurant-guide
* premade

No more duplicated inline prompts.

---

## ‚úÖ **UNIFY IMAGE GENERATION**

All features must call:

`imageService.generateMealImage(mealName, ingredients)`

No individual image endpoints.

---

## ‚úÖ **UNIFY MEDICAL BADGES**

Extract badge logic into:

`server/services/ai/medicalBadgeEngine.ts`

and use it across all AI systems.

---

## ‚úÖ **VERIFICATION REQUIREMENTS**

After implementation:

1. AI Meal Creator generates consistent UnifiedMeal objects.
2. AI Premades generate full meal objects (not just images).
3. Craving Creator generates from the unified generator.
4. Fridge Rescue works the same as before.
5. Restaurant Guide returns UnifiedMeal[] instead of unique shape.
6. All features return identical response formats.
7. All image URLs work.
8. All nutrition formats match.
9. All errors follow unified error JSON.

---

**END PROMPT**

---

# ‚úÖ Final Note

This prompt will:

* Fix ALL inconsistent AI behaviors
* Prevent backend conflicts
* Make every generator reliable
* Make debugging 10x easier
* Future-proof your app
* Make App Store reviewers happy
* Eliminate the random 404 problem
* Give you ONE brain powering EVERYTHING
* Make Emotion AI truly unified

When you drop this into the architect channel, they will know EXACTLY what to do.

---

If you want, I can also generate:

### üîß The full unified folder structure

### üß™ Automated test plan

### üß± Step-by-step migration plan per feature

### üß© TypeScript interfaces

### ‚öôÔ∏è The updated OpenAI call wrapper

Just say **‚ÄúGive me the full architecture plan.‚Äù**
