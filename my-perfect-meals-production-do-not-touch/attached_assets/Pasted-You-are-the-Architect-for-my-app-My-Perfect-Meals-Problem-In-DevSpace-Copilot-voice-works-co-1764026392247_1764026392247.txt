You are the Architect for my app “My Perfect Meals.”

Problem:
- In DevSpace, Copilot voice works correctly (Whisper + ElevenLabs).
- In my Replit deployment (pre-production app), Copilot voice does NOT work.
- I want you to figure out EXACTLY why deployment is broken and tell me what to fix.

Do NOT change any business logic or Copilot behavior. Your job is config + wiring.

Step 1 – Verify environment variables (deployment vs dev)
1. Open the server code where ElevenLabs / voice is configured (likely server/routes.ts or similar).
2. List ALL env vars used for voice/TTS/transcription, including:
   - ELEVENLABS_API_KEY (or similar)
   - ELEVENLABS_VOICE_ID
   - ELEVENLABS_MODEL_ID (if used)
   - OPENAI_API_KEY (if Whisper is called from the server)
3. Check the Replit Deployment environment (NOT just the DevSpace):
   - Confirm each of those env vars is defined there.
   - Confirm names match EXACTLY what the code expects (case-sensitive).
4. If any are missing or misnamed, note it clearly in your report.

Step 2 – Inspect the deployed voice endpoint behavior
1. Find the API routes used by Copilot voice, for example:
   - POST /api/voice/transcribe
   - POST /api/voice/speak or /api/voice/tts
2. From the deployment logs, trigger a voice request by:
   - Using the deployed app URL
   - Pressing the voice button once
   - Trying a simple query like: “test”
3. Capture:
   - The HTTP status code(s) returned by the voice route
   - Any error messages (stack traces, “unauthorized”, “missing api key”, etc.)
4. If possible, log what the ElevenLabs client call returns in deployment.

Step 3 – Compare Dev vs Deployment behavior
1. Check for any dev-only guards, like:
   - if (process.env.NODE_ENV === "development") { … }
   - or checks using import.meta.env.MODE
2. Confirm that the frontend in deployment calls the same base path:
   - e.g. /api/voice/... and not a dev-only path.
3. If deployment is missing a proxy or API mount that exists in DevSpace, document that.

Step 4 – ElevenLabs configuration sanity check
1. In the server file where ElevenLabs is called:
   - Confirm which voice ID and model ID are used.
   - Confirm they are read from env vars, not hard-coded dev values.
2. If there is any try/catch around the ElevenLabs call, log the actual error in deployment so we can see:
   - invalid api key
   - quota exceeded
   - unsupported model
   - bad request payload
3. Summarize any mismatch or failure here.

Step 5 – Final report (DO NOT skip this)
Give me a short, direct report with:
1. The EXACT cause of voice failing in deployment (or the most likely cause if multiple).
2. The specific fixes you recommend, for example:
   - “Add ELEVENLABS_VOICE_ID to Replit deployment env with value: X”
   - “Remove NODE_ENV === 'development' guard around voice init in file Y line Z”
   - “Update frontend to call /api/voice/tts instead of /voice-tts in production”
3. Confirm whether code changes are required, or if this is 100% an environment/config issue.

Do NOT refactor Copilot or change any feature behavior. Only diagnose and fix what is required to make voice in the deployed Replit app behave exactly like DevSpace.
