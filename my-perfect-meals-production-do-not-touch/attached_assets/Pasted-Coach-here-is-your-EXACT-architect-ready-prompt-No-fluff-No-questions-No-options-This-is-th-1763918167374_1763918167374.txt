Coach, here is **your EXACT architect-ready prompt.**
No fluff. No questions. No options.
This is the **full implementation spec** the Replit architect needs to wire **THE Copilot Spotlight System** exactly the way you described.

Copy → Paste into the Architect chat.
This will put them in “do mode” with no room to improvise.

---

# ✅ **ARCHITECT PROMPT — IMPLEMENT COPILOT SPOTLIGHT SYSTEM**

**TITLE:** Implement Copilot Spotlight Walkthrough System (Navigation + Highlight + Knowledge Fallback)

---

# **SUMMARY**

Implement a full spotlight-guided walkthrough system for the Copilot.
When the user says ANY feature keyword, Copilot:

1. **Detects feature by keyword** (fuzzy match)
2. **Navigates to the feature page automatically**
3. **Starts the walkthrough for that feature**
4. **Dims the entire screen**
5. **Highlights ONLY the current step target**
6. **Displays short text instruction**
7. **Advances automatically when user completes the step**
8. **Ends the walkthrough with spotlight fade-out**

The Copilot already has:

* Knowledge engine
* Walkthrough registry
* Voice transcription
* Command registry
* Data-walkthrough-target tags
* Basic highlight overlay (unused)

This is the missing wiring.

---

# **REQUIRED IMPLEMENTATION (NO QUESTIONS)**

## ✅ 1. **Add Keyword → Feature Mapping**

Create a file:

`client/src/copilot/KeywordFeatureMap.ts`

Mapping should be **fuzzy** (contains-match), not exact-match.

Include these triggers:

```
fridge, rescue → /fridge-rescue
weekly, meal board, board → /weekly-meal-board
beach, beach body, hard body → /beach-body-meal-board
craving, creator → /craving-creator-landing
alcohol, drinks → /social-hub/alcohol
find meals, find, search → /social-hub/find
restaurant → /social-hub/restaurant-guide
diabetic, diabetes → /clinical/diabetes
glp, glp1 → /clinical/glp1
anti, anti-inflammatory → /clinical/anti-inflammatory
kids → /kids
shopping, grocery → /shopping-list-v2
calculator, macros → /macro-calculator
journal → /daily-health-journal
biometrics → /biometrics
```

Return both:

* `path`
* `walkthroughId`

---

## ✅ 2. **Update CopilotCommandRegistry to Use Keyword Map**

In `CopilotCommandRegistry.ts` → inside `handleVoiceQuery()`:

### Add new logic BEFORE the “I’m still learning” fallback:

```
const match = findFeatureFromKeywords(query);
if (match) {
   setLocation(match.path);
   startWalkthrough(match.walkthroughId);
   return { type: "walkthrough", feature: match.walkthroughId };
}
```

`findFeatureFromKeywords` comes from the new mapping file.

This guarantees ANY mention of the feature name triggers navigation + walkthrough.

---

## ✅ 3. **Enable Spotlight Overlay (GLOBAL)**

Create a global overlay component:

`client/src/components/copilot/SpotlightOverlay.tsx`

It must:

* dim entire screen with black-glass
* highlight target element by selector from walkthrough step
* softly glow the border
* auto-scroll into view
* disable pointer events outside spotlight
* allow pointer events inside spotlight

Mount it inside:

`CopilotSheet.tsx`
right below root-level div, controlled by:

```
{walkthroughActive && <SpotlightOverlay step={currentStep} />}
```

---

## ✅ 4. **Walkthrough Engine Enhancements**

Modify `WalkthroughEngine.ts`:

### ✔ Replace long paragraphs with short instructions

(text already stored in registry — truncate to 1–2 sentences)

### ✔ Add user-action listeners

Add listeners to detect completion:

* input change
* button click
* dropdown change
* toggle
* onBlur
* mutation observer when elements update

When completed → `advanceWalkthrough()`.

### ✔ Add auto-advance timeout fallback

If user doesn’t interact for 10 seconds, pulse the spotlight target.

---

## ✅ 5. **Walkthrough Script Updates**

In `WalkthroughRegistry.ts`:

Rewrite all steps into SHORT instructions.

Example for Fridge Rescue:

```
step 1:
  target: "#fridge-input"
  instruction: "Type the items you have at home. Example: chicken, eggs, spinach."

step 2:
  target: "#fridge-servings"
  instruction: "Choose your serving size."

step 3:
  target: "#generate-button"
  instruction: "Press Generate Meal.”

step 4:
  target: ".meal-card"
  instruction: "Scroll to see your meal. Tap any card to view details."
```

All features need this style.

---

## ✅ 6. **Auto-Start Walkthrough After Navigation**

Inside each page component root:

```ts
useEffect(() => {
  if (copilotRequestedWalkthrough === 'fridge-rescue') {
     startWalkthrough("fridge-rescue");
  }
}, []);
```

Use standardized key for each feature.

---

## ✅ 7. **Shorter Copilot Responses**

In CopilotSheet.tsx:

When walkthrough starts, Copilot should speak only 1 short line:

“Starting your walkthrough for Fridge Rescue.”

Everything else is handled by spotlight steps.

Remove long “explainFeature” paragraphs from spoken output.

Still allow text explanation when user explicitly asks:

“Explain Fridge Rescue.”

---

## ✅ 8. **Add Optional Voice Selection (Male/Female)**

This does NOT need implementation now.

Just:

In `CopilotSettings.tsx` create:

```
voice: "male" | "female"
```

Use different ElevenLabs voices when reading instructions.

(Implementation can come later — this is just config prep.)

---

# **DO NOT CHANGE ANYTHING ELSE**

No UI redesign
No feature changes
No unrelated refactors
No removing existing commands
No router rewrites

Only wire navigation → spotlight → walkthrough → action detection.

---

# **DELIVERABLES**

Everything above must be implemented and tested:

* Keyword matching
* Automatic navigation
* Spotlight dimming system
* Step-by-step highlight
* Action detection
* Walkthrough scripts updated
* Copilot short responses
* Voice option config

This must work for both:

* Voice commands
* Typed commands

---

# **END OF SPEC**

Paste this exactly as-is. The architect will know what to do.
