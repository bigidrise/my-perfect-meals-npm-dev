ğŸ”¥ **PHASE C.7 â€” MULTI-HUB BRANCHING WALKTHROUGHS**
**This is the most complex guidance upgrade yet.**
We're now teaching Copilot how to run intelligent, branching walkthroughs inside Hubs that have multiple sub-pagesâ€¦ **without overwhelming the user** and **without dumping a list of 9 items in their face**.

Youâ€™re going to get the **full architect-ready package**, zero clarifications needed.

Letâ€™s go.

---

# ğŸš€ **PHASE C.7 GOAL**

Enable Copilot to intelligently guide users through:

### **1. Craving Hub**

(Craving Creator + Craving Premades)

### **2. Kids Hub**

(Kids Meals + Toddler Meals)

### **3. Alcohol Hub**

(Lean & Social, Mocktails, Wine, Beer, Bourbon, Alcohol Log, Weaning Off Tools, etc.)

### **4. Socializing Hub**

(Restaurant Guide + Find Meals Near Me)

Each hub needs:
âœ… Branch-Aware Logic
âœ… Smart Sub-Page Navigation
âœ… Hub-First Context
âœ… Walkthrough linking
âœ… Speech + text graceful fallback

---

# ğŸŸ© **WHAT WE BUILD IN C.7**

This phase adds a **new layer**:

## â­ **HubWalkthroughEngine** (like MealWalkthroughEngine, but for hubs)

The job:

1. Detect: â€œUser is inside a hubâ€
2. Ask ONE question:
   **â€œWhich part do you want?â€**
3. Allow BOTH:

   * user taps
   * user says the sub-page name
4. Auto-activate that sub-pageâ€™s walkthrough
5. Handle large hubs CLEANLY (like Alcohol Hub)

This system is **parallel to Phase B navigation and Phase C.1 auto-advance**, not replacing anything.

---

# ğŸŸ§ **C.7 ARCHITECT IMPLEMENTATION PACKAGE**

Copy/paste ready.

---

# ğŸ”· **A. REQUIRED: 1 NEW ENGINE FILE**

### **`HubWalkthroughEngine.ts`**

Location:
`client/src/components/copilot/walkthrough/engines/HubWalkthroughEngine.ts`

Core responsibilities:

```ts
export class HubWalkthroughEngine {
  constructor(hubId, subpages, callback){}
  
  start() {}        // show â€œWhich page inside this hub?â€
  cancel() {}       // cleanup
  handleSelection() // triggered by click or speech
}
```

**Must support:**

* voice input
* text input
* tap/click
* timeout fallback
* error fallback (â€œDid you mean ___?â€)

---

# ğŸ”· **B. NEW `data-testid` REQUIREMENTS**

We need a consistent anchor on every hub for Copilot to â€œseeâ€ the sub-page buttons.

### **Craving Hub**

```
data-testid="cravinghub-creator"
data-testid="cravinghub-premades"
```

### **Kids Hub**

```
data-testid="kidshub-kids"
data-testid="kidshub-toddler"
```

### **Socializing Hub**

```
data-testid="socialhub-find"
data-testid="socialhub-guide"
```

### **Alcohol Hub** (8 pages)

```
data-testid="alcoholhub-lean"
data-testid="alcoholhub-mocktails"
data-testid="alcoholhub-wine"
data-testid="alcoholhub-beer"
data-testid="alcoholhub-bourbon"
data-testid="alcoholhub-log"
data-testid="alcoholhub-weaning"
data-testid="alcoholhub-pairing"
```

These do **not** change UI behaviorâ€”they simply mark existing buttons.

---

# ğŸ”· **C. REQUIRED EVENT EMITTERS**

Every hub must fire:

### **1. â€œopenedâ€**

When the hub screen successfully loads.

```ts
window.dispatchEvent(new Event("opened"));
```

### **2. â€œselectedâ€**

When user taps a subpage.

```ts
window.dispatchEvent(new Event("selected"));
```

### **3. â€œspokenâ€**

When voice selects a subpage.

```ts
window.dispatchEvent(new Event("spoken"));
```

---

# ğŸ”· **D. SCRIPT STRUCTURE (PER HUB)**

Each hub gets one script:

```
CravingHubWalkthroughScript
KidsHubWalkthroughScript
AlcoholHubWalkthroughScript
SocialHubWalkthroughScript
```

Each has 3 steps ONLY (no deep steps):

---

### **Example: CravingHubWalkthroughScript**

```ts
title: "Craving Hub Walkthrough",
uiReady: false,
steps: [
  {
    message: "Welcome to the Craving Hub. Here you can generate healthy versions of your cravings.",
    waitForEvent: "opened"
  },
  {
    message: "Which part do you want? Creator or Premades?",
    waitForEvent: ["selected", "spoken"]
  },
  {
    message: "Great! Opening it now.",
    autoAdvance: true,
  }
]
```

After C.7 UI anchors are installed â†’ flip `uiReady: true`.

---

# ğŸ”· **E. ROUTING SPECS**

CopilotCommandRegistry must be updated:

If user says:

* â€œCraving Creatorâ€ â†’
  If inside the hub: go directly to Creator
  If NOT: open hub â†’ then sub-selection

* â€œWine pairingâ€ â†’
  If inside Alcohol Hub: open Wine Pairing
  If NOT: open hub â†’ then route

* â€œKids mealsâ€ â†’
  If inside Kids Hub: open Kids Meals
  If not, open hub first

This is **branching logic**, not simple navigation.

---

# ğŸ”· **F. ARCHITECT PROMPT â€” PHASE C.7**

Copy/paste exactly:

```
You are the Architect. Implement Phase C.7 as follows:

1. Create HubWalkthroughEngine.ts with start(), cancel(), and handleSelection() 
   using the specifications provided above.

2. Add the new data-testid anchors to each Hub:
   - Craving Hub (2)
   - Kids Hub (2)
   - Socializing Hub (2)
   - Alcohol Hub (8)
   Total: 14 anchors

3. Add the event emitters â€œopenedâ€, â€œselectedâ€, and â€œspokenâ€ 
   in all hub screens and subpage click handlers.

4. Create 4 new hub-level walkthrough scripts:
   - CravingHubWalkthroughScript
   - KidsHubWalkthroughScript
   - AlcoholHubWalkthroughScript
   - SocialHubWalkthroughScript

5. Register all scripts in ScriptRegistry with unique walkthroughIds.

6. Update CopilotCommandRegistry to:
   - detect hub context
   - route to subpage if spoken inside hub
   - route to hub first if spoken outside hub
   - launch the correct walkthrough script when hub opens

7. Do not modify Phase B routing. Do not modify Meal Builder engines.

8. After all data-testid anchors and events are wired, set uiReady: true on all 4 scripts.

9. Restart workflow and verify zero LSP errors and correct event sequencing.

Begin.
```

---

# ğŸ”¥ READY FOR C.8

After C.7 is done, we move into:

### **C.8 â€” Mini-Walkthroughs for Simple Pages**

Fridge Rescue
Macro Calculator
Biometrics
Master Shopping
Get Inspiration

Just say:
ğŸ‘‰ **â€œC.8â€**

When you're ready.
