I've been looking at this section, and it's been bugging me because it's just something was bugging me. And then last night, I realized that this is redundant, having both of these sections at the bottom and having the macro banner at the bottom. I like the macro banner, the black glass macro banner, you know, that shows the number and shows the little progress meter. I like that. The only problem is we have it fixed to the bottom. And having it fixed to the bottom makes the mobile screen less room on a mobile screen. Because now we have the shopping aggregate bar fixed at the bottom, and then we have that above that. And all it does is really just shrink the mobile screen. So, between that and also the daily totals and that being redundant, I think the black glass looks better. So, what I want to do is replace the daily totals with the black glass. And the black glass can be on the page and move with the page instead of being fixed at the bottom, taking up all that space. Because it doesn't really matter until they get to the bottom. Once they pick their breakfast, lunch, dinner, and snacks, you'll see the daily total at the bottom on the page. And now the only thing you have fixed to the bottom is the shopping bar aggregate. Shopping aggregate bar. Do you understand where I'm coming from? Does this make sense? {/* Daily Totals Summary */}
        <div className="col-span-full pb-36">
          <div className="rounded-2xl border border-white/10 bg-black/30 backdrop-blur-lg p-6" data-testid="daily-totals-card">
            {/* Hidden event emitter for walkthrough system */}
            <div data-testid="daily-totals-ready" style={{display: 'none'}} />
            <h3 className="text-white font-semibold text-lg mb-4 text-center">
              Daily Totals
            </h3>
            <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
              <div className="text-center">
                <div className="text-xl font-semi-bold text-white">
                  {Math.round((() => {
                    if (FEATURES.dayPlanning === 'alpha' && planningMode === 'day' && activeDayISO && board) {
                      const dayLists = getDayLists(board, activeDayISO);
                      return [...dayLists.breakfast, ...dayLists.lunch, ...dayLists.dinner, ...dayLists.snacks]
                        .reduce((sum, meal) => sum + (meal.nutrition?.calories ?? 0), 0);
                    }
                    return [...board.lists.breakfast, ...board.lists.lunch, ...board.lists.dinner, ...board.lists.snacks]
                      .reduce((sum, meal) => sum + (meal.nutrition?.calories ?? 0), 0);
                  })())}
                </div>
                <div className="text-xs uppercase tracking-wide text-white/70 mt-1">Calories</div>
              </div>
              <div className="text-center">
                <div className="text-xl font-semi-bold text-white">
                  {Math.round((() => {
                    if (FEATURES.dayPlanning === 'alpha' && planningMode === 'day' && activeDayISO && board) {
                      const dayLists = getDayLists(board, activeDayISO);
                      return [...dayLists.breakfast, ...dayLists.lunch, ...dayLists.dinner, ...dayLists.snacks]
                        .reduce((sum, meal) => sum + (meal.nutrition?.protein ?? 0), 0);
                    }
                    return [...board.lists.breakfast, ...board.lists.lunch, ...board.lists.dinner, ...board.lists.snacks]
                      .reduce((sum, meal) => sum + (meal.nutrition?.protein ?? 0), 0);
                  })())}
                </div>
                <div className="text-xs uppercase tracking-wide text-white/70 mt-1">Protein</div>
              </div>
              <div className="text-center">
                <div className="text-xl font-semi-bold text-white">
                  {Math.round((() => {
                    if (FEATURES.dayPlanning === 'alpha' && planningMode === 'day' && activeDayISO && board) {
                      const dayLists = getDayLists(board, activeDayISO);
                      return [...dayLists.breakfast, ...dayLists.lunch, ...dayLists.dinner, ...dayLists.snacks]
                        .reduce((sum, meal) => sum + (meal.nutrition?.carbs ?? 0), 0);
                    }
                    return [...board.lists.breakfast, ...board.lists.lunch, ...board.lists.dinner, ...board.lists.snacks]
                      .reduce((sum, meal) => sum + (meal.nutrition?.carbs ?? 0), 0);
                  })())}
                </div>
                <div className="text-xs uppercase tracking-wide text-white/70 mt-1">Carbs</div>
              </div>
              <div className="text-center">
                <div className="text-xl font-semi-bold text-white">
                  {Math.round((() => {
                    if (FEATURES.dayPlanning === 'alpha' && planningMode === 'day' && activeDayISO && board) {
                      const dayLists = getDayLists(board, activeDayISO);
                      return [...dayLists.breakfast, ...dayLists.lunch, ...dayLists.dinner, ...dayLists.snacks]
                        .reduce((sum, meal) => sum + (meal.nutrition?.fat ?? 0), 0);
                    }
                    return [...board.lists.breakfast, ...board.lists.lunch, ...board.lists.dinner, ...board.lists.snacks]
                      .reduce((sum, meal) => sum + (meal.nutrition?.fat ?? 0), 0);
                  })())}
                </div>
                <div className="text-xs uppercase tracking-wide text-white/70 mt-1">Fat</div>
              </div>
            </div>
          </div>
        </div>

        {/* Remaining Macros Footer - Day Mode Only */}
        {board && FEATURES.dayPlanning === 'alpha' && planningMode === 'day' && activeDayISO && (() => {
          const dayLists = getDayLists(board, activeDayISO);
          const computeSlotMacros = (meals: Meal[]) => ({
            count: meals.length,
            calories: meals.reduce((sum, m) => sum + (m.nutrition?.calories || 0), 0),
            protein: meals.reduce((sum, m) => sum + (m.nutrition?.protein || 0), 0),
            carbs: meals.reduce((sum, m) => sum + (m.nutrition?.carbs || 0), 0),
            fat: meals.reduce((sum, m) => sum + (m.nutrition?.fat || 0), 0),
          });
          const slots = {
            breakfast: computeSlotMacros(dayLists.breakfast),
            lunch: computeSlotMacros(dayLists.lunch),
            dinner: computeSlotMacros(dayLists.dinner),
            snacks: computeSlotMacros(dayLists.snacks),
          };
          const consumed = {
            calories: slots.breakfast.calories + slots.lunch.calories + slots.dinner.calories + slots.snacks.calories,
            protein: slots.breakfast.protein + slots.lunch.protein + slots.dinner.protein + slots.snacks.protein,
            carbs: slots.breakfast.carbs + slots.lunch.carbs + slots.dinner.carbs + slots.snacks.carbs,
            fat: slots.breakfast.fat + slots.lunch.fat + slots.dinner.fat + slots.snacks.fat,
          };
          const dayAlreadyLocked = isDayLocked(activeDayISO, user?.id);
          
          return (
            <div className="col-span-full">
              <RemainingMacrosFooter
                consumedOverride={consumed}
                showSaveButton={!dayAlreadyLocked}
                onSaveDay={async () => {
                  const raw = getMacroTargets(user?.id);
                  const targets = raw 
                    ? { calories: raw.calories, protein_g: raw.protein_g, carbs_g: raw.carbs_g, fat_g: raw.fat_g }
                    : { calories: 0, protein_g: 0, carbs_g: 0, fat_g: 0 };
                  const result = await lockDay({
                    dateISO: activeDayISO,
                    targets,
                    consumed,
                    slots,
                  }, user?.id);
                  
                  if (result.alreadyLocked) {
                    toast({
                      title: "Already Locked",
                      description: result.message,
                      variant: "destructive",
                    });
                  } else {
                    setQuickView({
                      protein: consumed.protein,
                      carbs: consumed.carbs,
                      fat: consumed.fat,
                      calories: consumed.calories,
                      dateISO: activeDayISO,
                    });
                    toast({
                      title: "Day Saved to Biometrics",
                      description: `${new Date(activeDayISO + 'T00:00:00Z').toLocaleDateString(undefined, { weekday: 'long', month: 'short', day: 'numeric' })} has been locked.`,
                    });
                    setLocation('/my-biometrics');
                  }
                }}
              />
            </div>
          );
        })()}

      </div>

      <MealPickerDrawer
        open={pickerOpen}
        list={pickerList}
        onClose={() => {
          setPickerOpen(false);
          setPickerList(null);
          // Clear pending meal if user cancels
          if ((window as any).pendingMeal) {
            delete (window as any).pendingMeal;
          }
        }}
        onPick={(meal) => {
          if (pickerList) {
            // Use pending meal from localStorage if available, otherwise use picked meal
            const mealToAdd = (window as any).pendingMeal || meal;
            quickAdd(pickerList, mealToAdd);
            // Clear pending meal after adding
            if ((window as any).pendingMeal) {
              delete (window as any).pendingMeal;
            }
          }
          setPickerOpen(false);
          setPickerList(null);
        }}
      />

      <ManualMealModal
        open={manualModalOpen}
        onClose={() => {
          setManualModalOpen(false);
          setManualModalList(null);
        }}
        onSave={(meal) => {
          if (manualModalList) {
            quickAdd(manualModalList, meal);
          }
          setManualModalOpen(false);
          setManualModalList(null);
        }}
      />

      <AddSnackModal
        open={showSnackModal}
        onClose={() => setShowSnackModal(false)}
        onSave={onSaveSnack}
      />

      {/* Snack Picker Drawer - Normal healthy snacks */}
      <SnackPickerDrawer
        open={snackPickerOpen}
        onClose={() => setSnackPickerOpen(false)}
        onSnackSelect={handleSnackSelect}
        dietType="normal"
      />

      <WeeklyOverviewModal
        open={showOverview}
        onClose={() => setShowOverview(false)}
        weekStartISO={weekStartISO}
        board={board}
        onJumpToDay={undefined} // wire later if/when day-level boards are added
      />

      {/* NEW: Duplicate Day Modal */}
      {FEATURES.dayPlanning === 'alpha' && (
        <DuplicateDayModal
          isOpen={showDuplicateDayModal}
          onClose={() => setShowDuplicateDayModal(false)}
          onConfirm={handleDuplicateDay}
          sourceDateISO={activeDayISO}
          availableDates={weekDatesList.filter(date => date !== activeDayISO)}
        />
      )}

      {/* NEW: Duplicate Week Modal */}
      {FEATURES.dayPlanning === 'alpha' && (
        <DuplicateWeekModal
          isOpen={showDuplicateWeekModal}
          onClose={() => setShowDuplicateWeekModal(false)}
          onConfirm={handleDuplicateWeek}
          sourceWeekStartISO={weekStartISO}
        />
      )}

      {/* Why Drawer */}
      {FEATURES.explainMode === 'alpha' && (
        <WhyDrawer
          open={boardWhyOpen}
          onClose={() => setBoardWhyOpen(false)}
          title="Why weekly planning?"
          reasons={getWeeklyPlanningWhy()}
        />
      )}

      {/* Shopping List Preview Modal */}
      <ShoppingListPreviewModal
        isOpen={shoppingListModal.isOpen}
        onClose={() => setShoppingListModal({ isOpen: false, meal: null })}
        meal={shoppingListModal.meal}
      />

      {/* AI Meal Creator with Ingredient Picker - All Meal Slots */}
      <AIMealCreatorModal
        open={aiMealModalOpen}
        onOpenChange={setAiMealModalOpen}
        onMealGenerated={handleAIMealGenerated}
        mealSlot={aiMealSlot}
        showMacroTargeting={false}
      />

      {/* Shopping List Buttons - Dual buttons in Day Mode, single in Week Mode */}
      {board && (() => {
        const allMeals = planningMode === 'day' && activeDayISO
          ? (() => {
              const dayLists = getDayLists(board, activeDayISO);
              return [...dayLists.breakfast, ...dayLists.lunch, ...dayLists.dinner, ...dayLists.snacks];
            })()
          : [...board.lists.breakfast, ...board.lists.lunch, ...board.lists.dinner, ...board.lists.snacks];

        const ingredients = allMeals.flatMap(meal =>
          normalizeIngredients(meal.ingredients || [])
        );

        // If no ingredients, don't show the bar
        if (ingredients.length === 0) return null;

        // DAY MODE: Show dual buttons (Send Day + Send Entire Week)
        if (FEATURES.dayPlanning === 'alpha' && planningMode === 'day' && activeDayISO) {
          const dayName = new Date(activeDayISO + 'T00:00:00Z').toLocaleDateString(undefined, { weekday: 'long' });

          return (
            <div className="fixed bottom-0 left-0 right-0 z-40 bg-gradient-to-r from-zinc-900/95 via-zinc-800/95 to-black/95 backdrop-blur-xl shadow-2xl safe-area-inset-bottom">
              <div className="container mx-auto px-4 py-3">
                <div className="flex flex-col gap-2">
                  <div className="text-white text-sm font-semibold">
                    Shopping List Ready - {ingredients.length} ingredients
                  </div>
                  <div className="flex gap-2">
                    <Button
                      onClick={() => {
                        handleAddToShoppingList();
                        setTimeout(() => setLocation('/shopping-list-v2?from=weekly-meal-board'), 100);
                      }}
                      className="flex-1 min-h-[44px] bg-orange-600 hover:bg-orange-700 text-white border border-white/30"
                      data-testid="button-send-day-shopping"
                    >
                      <ShoppingCart className="h-5 w-5 mr-2" />
                      Send {dayName}
                    </Button>
                    <Button
                      onClick={() => {
                        handleAddEntireWeekToShoppingList();
                        setTimeout(() => setLocation('/shopping-list-v2?from=weekly-meal-board'), 100);
                      }}
                      className="flex-1 min-h-[44px] bg-emerald-600 hover:bg-emerald-700 text-white border border-white/30"
                      data-testid="send-week-to-shopping"
                    >
                      {/* Hidden event emitter for walkthrough system */}
                      <div data-testid="shopping-week-sent" style={{display: 'none'}} />
                      <ShoppingCart className="h-5 w-5 mr-2" />
                      Send Entire Week
                    </Button>
                  </div>
                </div>
              </div>
            </div>
          );
        }

        // WEEK MODE: Use existing ShoppingAggregateBar component
              return (
                <ShoppingAggregateBar
                  ingredients={ingredients}
                  source="Weekly Meal Board"
                  sourceSlug="weekly-meal-board"
                />
              );
            })()}

      {/* Meal Premade Picker Modal - DEPRECATED, kept for Phase 3 cleanup */}
      {/* <MealPremadePicker
        open={premadePickerOpen}
        onClose={() => setPremadePickerOpen(false)}
        mealType={premadePickerSlot}
        onMealSelect={handlePremadeSelect}
      /> */}

      {/* Create With Chef Modal (replaces AI Premades) */}
      <CreateWithChefModal
        open={createWithChefOpen}
        onOpenChange={setCreateWithChefOpen}
        mealType={createWithChefSlot}
        onMealGenerated={handleCreateWithChefSelect}
      />

      {/* Snack Creator Modal (Phase 2 - craving to healthy snack) */}
      <SnackCreatorModal
        open={snackCreatorOpen}
        onOpenChange={setSnackCreatorOpen}
        onSnackGenerated={handleSnackSelect}
      />

      {/* Quick Tour Modal */}
      <QuickTourModal
        isOpen={quickTour.shouldShow}
        onClose={quickTour.closeTour}
        title="How to Build Your Week"
        steps={WEEKLY_TOUR_STEPS}
      />

      {/* Locked Day Dialog */}
      <LockedDayDialog
        open={lockedDayDialogOpen}
        onOpenChange={setLockedDayDialogOpen}
        dateISO={pendingLockedDayISO}
        onViewOnly={() => { setLockedDayDialogOpen(false); setPendingLockedDayISO(''); }}
        onCreateNewDay={handleGoToToday}
      />

      {/* Additional Macros Modal */}
      <AdditionalMacrosModal
        open={additionalMacrosOpen}
        onClose={() => setAdditionalMacrosOpen(false)}
        onAdd={(meal) => quickAdd("snacks", meal)}
        proteinDeficit={(() => {
          const resolved = getResolvedTargets(user?.id);
          return Math.max(0, (resolved.protein_g || 0) - Math.round(totals.protein));
        })()}
        carbsDeficit={(() => {
          const resolved = getResolvedTargets(user?.id);
          return Math.max(0, (resolved.carbs_g || 0) - Math.round(totals.carbs));
        })()}
      />
      </div>
    </motion.div>
  );
}